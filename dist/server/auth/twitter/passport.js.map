{"version":3,"sources":["auth/twitter/passport.js"],"names":["setup","User","config","use","consumerKey","twitter","clientID","consumerSecret","clientSecret","callbackURL","token","tokenSecret","profile","done","_json","id","findOne","exec","then","user","name","displayName","username","role","provider","save","savedUser","catch","err"],"mappings":";;;;;QAGgBA,K,GAAAA,K;;AAHhB;;;;AACA;;;;AAEO,SAASA,KAAT,CAAeC,IAAf,EAAqBC,MAArB,EAA6B;AAClC,qBAASC,GAAT,CAAa,8BAAoB;AAC/BC,iBAAaF,OAAOG,OAAP,CAAeC,QADG;AAE/BC,oBAAgBL,OAAOG,OAAP,CAAeG,YAFA;AAG/BC,iBAAaP,OAAOG,OAAP,CAAeI;AAHG,GAApB,EAKb,UAASC,KAAT,EAAgBC,WAAhB,EAA6BC,OAA7B,EAAsCC,IAAtC,EAA4C;AAC1CD,YAAQE,KAAR,CAAcC,EAAd,QAAsBH,QAAQE,KAAR,CAAcC,EAApC;AACAH,YAAQG,EAAR,QAAgBH,QAAQG,EAAxB;;AAEAd,SAAKe,OAAL,CAAa,EAAC,cAAcJ,QAAQG,EAAvB,EAAb,EAAyCE,IAAzC,GACGC,IADH,CACQ,gBAAQ;AACZ,UAAGC,IAAH,EAAS;AACP,eAAON,KAAK,IAAL,EAAWM,IAAX,CAAP;AACD;;AAEDA,aAAO,IAAIlB,IAAJ,CAAS;AACdmB,cAAMR,QAAQS,WADA;AAEdC,kBAAUV,QAAQU,QAFJ;AAGdC,cAAM,MAHQ;AAIdC,kBAAU,SAJI;AAKdnB,iBAASO,QAAQE;AALH,OAAT,CAAP;AAOAK,WAAKM,IAAL,GACGP,IADH,CACQ;AAAA,eAAaL,KAAK,IAAL,EAAWa,SAAX,CAAb;AAAA,OADR,EAEGC,KAFH,CAES;AAAA,eAAOd,KAAKe,GAAL,CAAP;AAAA,OAFT;AAGD,KAhBH,EAiBGD,KAjBH,CAiBS;AAAA,aAAOd,KAAKe,GAAL,CAAP;AAAA,KAjBT;AAkBD,GA3BY,CAAb;AA4BD","file":"passport.js","sourcesContent":["import passport from 'passport';\r\nimport {Strategy as TwitterStrategy} from 'passport-twitter';\r\n\r\nexport function setup(User, config) {\r\n  passport.use(new TwitterStrategy({\r\n    consumerKey: config.twitter.clientID,\r\n    consumerSecret: config.twitter.clientSecret,\r\n    callbackURL: config.twitter.callbackURL\r\n  },\r\n  function(token, tokenSecret, profile, done) {\r\n    profile._json.id = `${profile._json.id}`;\r\n    profile.id = `${profile.id}`;\r\n\r\n    User.findOne({'twitter.id': profile.id}).exec()\r\n      .then(user => {\r\n        if(user) {\r\n          return done(null, user);\r\n        }\r\n\r\n        user = new User({\r\n          name: profile.displayName,\r\n          username: profile.username,\r\n          role: 'user',\r\n          provider: 'twitter',\r\n          twitter: profile._json\r\n        });\r\n        user.save()\r\n          .then(savedUser => done(null, savedUser))\r\n          .catch(err => done(err));\r\n      })\r\n      .catch(err => done(err));\r\n  }));\r\n}\r\n"]}